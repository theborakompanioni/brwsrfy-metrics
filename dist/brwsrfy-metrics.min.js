!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.brwsrfyMetrics=t()}}(function(){return function t(e,n,i){function r(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return r(n?n:t)},c,c.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,n){var i=t("./node_modules/metrics/metrics"),r=t("./node_modules/metrics/reporting/report");n.Histogram=i.Histogram,n.Meter=i.Meter,n.Counter=i.Counter,n.Timer=i.Timer,n.Report=r},{"./node_modules/metrics/metrics":6,"./node_modules/metrics/reporting/report":9}],2:[function(t,e){var n=(t("./utils"),e.exports=function(t){this.content=[],this.scoreFunction=t});n.prototype={clone:function(){var t=new n(this.scoreFunction);return t.content=JSON.parse(JSON.stringify(this.content)),t},push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},peek:function(){return this.content[0]},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},remove:function(t){for(var e=this.content.length,n=0;e>n;n++)if(this.content[n]==t){var i=this.content.pop();return n!=e-1&&(this.content[n]=i,this.scoreFunction(i)<this.scoreFunction(t)?this.bubbleUp(n):this.sinkDown(n)),!0}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t];t>0;){var n=Math.floor((t+1)/2)-1,i=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(i)))break;this.content[n]=e,this.content[t]=i,t=n}},sinkDown:function(t){for(var e=this.content.length,n=this.content[t],i=this.scoreFunction(n);;){var r=2*(t+1),o=r-1,s=null;if(e>o){var a=this.content[o],u=this.scoreFunction(a);i>u&&(s=o)}if(e>r){var c=this.content[r],h=this.scoreFunction(c);(null==s?i:u)>h&&(s=r)}if(null==s)break;this.content[t]=this.content[s],this.content[s]=n,t=s}}}},{"./utils":3}],3:[function(t,e,n){n.mixin=function(){var t=function(e,n,i){for(var r in n)n.hasOwnProperty(r)&&(!i||"object"!=typeof n[r]||null===n[r]||n[r]instanceof Array?e[r]=n[r]:("undefined"==typeof e[r]&&(e[r]={}),t(e[r],n[r],i)))};return function(){var e,n,i=Array.prototype.slice.apply(arguments),r=!1;i.length>2&&"boolean"==typeof i[i.length-1]&&(r=i.pop()),e=i.shift(),n=i;for(var o=0,s=n.length;s>o;o++)t(e,n[o],r);return e}}()},{}],4:[function(t,e){var n=Math.pow(2,32),i=e.exports=function(){this.count=0,this.type="counter"};i.prototype.inc=function(t){t||(t=1),this.count+=t,this.count>n&&(this.count-=n+1)},i.prototype.dec=function(t){t||(t=1),this.count-=t,this.count<0&&(this.count=0)},i.prototype.clear=function(){this.count=0},i.prototype.printObj=function(){return{type:"counter",count:this.count}}},{}],5:[function(t,e){var n=t("../stats/exponentially_decaying_sample"),i=t("../stats/uniform_sample"),r=[.001,.01,.05,.1,.25,.5,.75,.9,.95,.98,.99,.999],o=e.exports=function(t){this.sample=t||new n(1028,.015),this.min=null,this.max=null,this.sum=null,this.varianceM=null,this.varianceS=null,this.count=0,this.type="histogram"};o.prototype.clear=function(){this.sample.clear(),this.min=null,this.max=null,this.sum=null,this.varianceM=null,this.varianceS=null,this.count=0},o.prototype.update=function(t,e){this.count++,this.sample.update(t,e),this.max=null===this.max?t:t>this.max?t:this.max,this.min=null===this.min?t:t<this.min?t:this.min,this.sum=null===this.sum?t:this.sum+t,this.updateVariance(t)},o.prototype.updateVariance=function(t){var e=this.varianceM,n=this.varianceS;1==this.count?this.varianceM=t:(this.varianceM=e+(t-e)/this.count,this.varianceS=n+(t-e)*(t-this.varianceM))},o.prototype.percentiles=function(t){t||(t=r);for(var e,n,i,o,s=this.sample.getValues().map(function(t){return parseFloat(t)}).sort(function(t,e){return t-e}),a={},u=0;u<t.length;u++)n=t[u]*(s.length+1),e=t[u],1>n?a[e]=s[0]:n>=s.length?a[e]=s[s.length-1]:(i=s[Math.floor(n)-1],o=s[Math.ceil(n)-1],a[e]=i+(n-Math.floor(n))*(o-i));return a},o.prototype.variance=function(){return this.count<1?null:this.varianceS/(this.count-1)},o.prototype.mean=function(){return 0==this.count?null:this.varianceM},o.prototype.stdDev=function(){return this.count<1?null:Math.sqrt(this.variance())},o.prototype.values=function(){return this.sample.getValues()},o.prototype.printObj=function(){var t=this.percentiles();return{type:"histogram",min:this.min,max:this.max,sum:this.sum,variance:this.variance(),mean:this.mean(),std_dev:this.stdDev(),count:this.count,median:t[.5],p75:t[.75],p95:t[.95],p99:t[.99],p999:t[.999]}},e.exports.createExponentialDecayHistogram=function(t,e){return new o(new n(t||1028,e||.015))},e.exports.createUniformHistogram=function(t){return new o(new i(t||1028))},e.exports.DEFAULT_PERCENTILES=r},{"../stats/exponentially_decaying_sample":10,"../stats/uniform_sample":13}],6:[function(t,e,n){n.Counter=t("./counter"),n.Histogram=t("./histogram"),n.Meter=t("./meter"),n.Timer=t("./timer")},{"./counter":4,"./histogram":5,"./meter":7,"./timer":8}],7:[function(t,e){var n=t("../stats/exponentially_weighted_moving_average.js"),i=e.exports=function(){this.m1Rate=n.createM1EWMA(),this.m5Rate=n.createM5EWMA(),this.m15Rate=n.createM15EWMA(),this.count=0,this.startTime=(new Date).getTime(),this.type="meter"};i.prototype.mark=function(t){t||(t=1),this.count+=t,this.m1Rate.update(t),this.m5Rate.update(t),this.m15Rate.update(t)},i.prototype.rates=function(){return{1:this.oneMinuteRate(),5:this.fiveMinuteRate(),15:this.fifteenMinuteRate(),mean:this.meanRate()}},i.prototype.fifteenMinuteRate=function(){return this.m15Rate.rate()},i.prototype.fiveMinuteRate=function(){return this.m5Rate.rate()},i.prototype.oneMinuteRate=function(){return this.m1Rate.rate()},i.prototype.meanRate=function(){return this.count/((new Date).getTime()-this.startTime)*1e3},i.prototype.printObj=function(){return{type:"meter",count:this.count,m1:this.oneMinuteRate(),m5:this.fiveMinuteRate(),m15:this.fifteenMinuteRate(),mean:this.meanRate(),unit:"seconds"}},i.prototype.tick=function(){this.m1Rate.tick(),this.m5Rate.tick(),this.m15Rate.tick()}},{"../stats/exponentially_weighted_moving_average.js":11}],8:[function(t,e){var n=t("./meter");Histogram=t("./histogram"),ExponentiallyDecayingSample=t("../stats/exponentially_decaying_sample");var i=e.exports=function(){this.meter=new n,this.histogram=new Histogram(new ExponentiallyDecayingSample(1028,.015)),this.clear(),this.type="timer"};i.prototype.update=function(t){this.histogram.update(t),this.meter.mark()},i.prototype.clear=function(){return this.histogram.clear()},i.prototype.count=function(){return this.histogram.count},i.prototype.min=function(){return this.histogram.min},i.prototype.max=function(){return this.histogram.max},i.prototype.mean=function(){return this.histogram.mean()},i.prototype.stdDev=function(){return this.histogram.stdDev()},i.prototype.percentiles=function(t){return this.histogram.percentiles(t)},i.prototype.values=function(){return this.histogram.values()},i.prototype.oneMinuteRate=function(){return this.meter.oneMinuteRate()},i.prototype.fiveMinuteRate=function(){return this.meter.fiveMinuteRate()},i.prototype.fifteenMinuteRate=function(){return this.meter.fifteenMinuteRate()},i.prototype.meanRate=function(){return this.meter.meanRate()},i.prototype.tick=function(){this.meter.tick()},i.prototype.printObj=function(){return{type:"timer",duration:this.histogram.printObj(),rate:this.meter.printObj()}}},{"../stats/exponentially_decaying_sample":10,"./histogram":5,"./meter":7}],9:[function(t,e){var n=function(t){var e=t.split("."),n=e.pop(),i=e.join(".");return{ns:i,name:n}},i=e.exports=function(t){this.trackedMetrics=t||{}};i.prototype.addMetric=function(t,e){var i=n(t);this.trackedMetrics[i.ns]||(this.trackedMetrics[i.ns]={}),this.trackedMetrics[i.ns][i.name]||(this.trackedMetrics[i.ns][i.name]=e)},i.prototype.getMetric=function(t){var e=n(t);if(this.trackedMetrics[e.ns])return this.trackedMetrics[e.ns][e.name]},i.prototype.summary=function(){var t={};for(namespace in this.trackedMetrics){t[namespace]={};for(name in this.trackedMetrics[namespace])t[namespace][name]=this.trackedMetrics[namespace][name].printObj()}return t}},{}],10:[function(t,e){var n=t("./sample"),i=t("../lib/binary_heap"),r=36e5,o=e.exports=function(t,e){this.limit=t,this.alpha=e,this.clear()};o.prototype=new n,o.prototype.getValues=function(){for(var t=[],e=this.values.clone();elt=e.pop();)t.push(elt.val);return t},o.prototype.size=function(){return this.values.size()},o.prototype.newHeap=function(){return new i(function(t){return t.priority})},o.prototype.now=function(){return(new Date).getTime()},o.prototype.tick=function(){return this.now()/1e3},o.prototype.clear=function(){this.values=this.newHeap(),this.count=0,this.startTime=this.tick(),this.nextScaleTime=this.now()+r},o.prototype.update=function(t,e){void 0==e?e=this.tick():e/=1e3;var n=this.weight(e-this.startTime)/Math.random(),i={val:t,priority:n};if(this.count<this.limit)this.count+=1,this.values.push(i);else{var r=this.values.peek();r.priority<n&&(this.values.push(i),this.values.pop())}this.now()>this.nextScaleTime&&this.rescale(this.now(),this.nextScaleTime)},o.prototype.weight=function(t){return Math.exp(this.alpha*t)},o.prototype.rescale=function(t){this.nextScaleTime=this.now()+r;var e=this.values.content,n=[],i=this.startTime;this.startTime=t&&t/1e3||this.tick();for(var o=0;o<e.length;o++)n.push({val:e[o].val,priority:e[o].priority*Math.exp(-this.alpha*(this.startTime-i))});this.values.content=n}},{"../lib/binary_heap":2,"./sample":12}],11:[function(t,e){var n=1-Math.exp(-5/60),i=1-Math.exp(-5/60/5),r=1-Math.exp(-5/60/15),o=EWMA=e.exports=function(t,e){var n=this;this.alpha=t,this.interval=e||5e3,this.initialized=!1,this.currentRate=0,this.uncounted=0,e&&(this.tickInterval=setInterval(function(){n.tick()},e),this.tickInterval.unref())};o.prototype.update=function(t){this.uncounted+=t||1},o.prototype.tick=function(){var t=this.uncounted/this.interval;this.uncounted=0,this.initialized?this.currentRate+=this.alpha*(t-this.currentRate):(this.currentRate=t,this.initialized=!0)},o.prototype.rate=function(){return 1e3*this.currentRate},o.prototype.stop=function(){clearInterval(this.tickInterval)},e.exports.createM1EWMA=function(){return new EWMA(n,5e3)},e.exports.createM5EWMA=function(){return new EWMA(i,5e3)},e.exports.createM15EWMA=function(){return new EWMA(r,5e3)}},{}],12:[function(t,e){var n=e.exports=function(){this.values=[],this.count=0},n=e.exports=function(){};n.prototype.init=function(){this.clear()},n.prototype.update=function(t){this.values.push(t)},n.prototype.clear=function(){this.values=[],this.count=0},n.prototype.size=function(){return this.values.length},n.prototype.print=function(){console.log(this.values)},n.prototype.getValues=function(){return this.values}},{}],13:[function(t,e){var n=(t("../lib/utils"),t("./sample")),i=e.exports=function(t){this.limit=t,this.count=0,this.init()};i.prototype=new n,i.prototype.update=function(t){if(this.count++,this.size()<this.limit)this.values.push(t);else{var e=parseInt(Math.random()*this.count);e<this.limit&&(this.values[e]=t)}}},{"../lib/utils":3,"./sample":12}]},{},[1])(1)});